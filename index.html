<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tree DP & Graph Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="p-4 md:p-6">

  <div id="importModal" class="modal-overlay">
    <div class="modal">
      <h3 class="font-bold text-lg mb-2">Import / Reset</h3>
      <p class="text-xs mb-2" style="color:var(--muted)">Format A (edge list): Line 1 is <code>V E</code>, Line 2 is V weights, then E lines of edges (<code>u v w</code>).<br>Format B (parent array): Line 1 is <code>n</code>, Line 2 is n weights, Line 3 is <code>p2 p3 ‚Ä¶ pn</code> (parent of each node).</p>
      <textarea id="importText" class="w-full" rows="6" placeholder="3 2&#10;1 2 3&#10;1 2 1&#10;2 3 1"></textarea>
      <div class="flex justify-end gap-2 mt-3">
        <button id="btnResetSave" class="btn px-3 py-1.5 rounded text-xs mr-auto" style="background: var(--danger); color: white;">Reset Save</button>
        <button id="btnModalClose" class="btn px-3 py-1.5 rounded text-xs" style="background:var(--border)">Cancel</button>
        <button id="btnModalImport" class="btn px-3 py-1.5 rounded text-xs" style="background:var(--accent); color:var(--bg)">Import</button>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto">
    <header class="mb-4">
      <h1 class="text-2xl md:text-3xl font-bold tracking-tight">Graph <span style="color: var(--accent);">Editor</span> & DP</h1>
    </header>

    <div class="grid lg:grid-cols-3 gap-4">
      <div class="lg:col-span-2 space-y-3">
        <div class="p-3 rounded-lg flex flex-col gap-3" style="background: var(--card); border: 1px solid var(--border);">
          <div class="flex flex-wrap gap-2 items-center justify-between">
            <div class="flex gap-2">
              <button id="btnAdd" class="mode-btn btn px-3 py-1.5 rounded text-xs font-medium">Add (A)</button>
              <button id="btnConnect" class="mode-btn btn px-3 py-1.5 rounded text-xs font-medium">Connect (C)</button>
              <button id="btnSelect" class="mode-btn btn px-3 py-1.5 rounded text-xs font-medium">Edit (S)</button>
            </div>
            <div class="flex gap-2">
              <button id="btnUndo" class="btn text-xs px-2 py-1 rounded" style="background: var(--border); color: var(--fg);">Undo</button>
              <button id="btnRedo" class="btn text-xs px-2 py-1 rounded" style="background: var(--border); color: var(--fg);">Redo</button>
              <button id="btnOpenImport" class="btn text-xs px-2 py-1 rounded" style="background: var(--border); color: var(--fg);">Menu</button>
              <button id="btnBeautify" class="btn text-xs px-2 py-1 rounded" style="background: var(--border); color: var(--fg);">Re-root</button>
            </div>
          </div>
          <div class="flex flex-wrap gap-x-6 gap-y-2 items-center border-t pt-3" style="border-color: var(--border);">
            <div class="flex gap-4">
              <div id="tglTreeContainer" class="toggle-container"><div id="tglTree" class="toggle-switch active"></div><span>Tree</span></div>
              <div id="tglDirectedContainer" class="toggle-container"><div id="tglDirected" class="toggle-switch active"></div><span>Directed</span></div>
              <div id="tglShowEdgeWContainer" class="toggle-container"><div id="tglShowEdgeW" class="toggle-switch"></div><span>Edge W</span></div>
            </div>
          </div>
        </div>

        <div class="canvas-container bg-grid">
          <canvas id="graphCanvas"></canvas>
        </div>

        <div class="p-3 rounded-lg" style="background: var(--card); border: 1px solid var(--border);">
          <div class="text-xs font-semibold mb-2 opacity-70">Vertex Content</div>
          <div id="displayOptionsContainer" class="flex flex-wrap gap-3"></div>
        </div>

        <div class="p-3 rounded-lg" style="background: var(--card); border: 1px solid var(--border);">
          <div class="flex justify-between items-center mb-2">
            <div class="flex items-center gap-2">
              <h3 class="font-semibold text-sm">DP Formulas</h3>
              <select id="dpExamples" class="text-xs py-1 px-2" style="font-family: 'Space Grotesk', sans-serif;">
                <option value="">Examples...</option>
                <option value="subtree_size">Subtree Size</option>
                <option value="subtree_sum">Subtree Sum</option>
                <option value="max_independent">Max Independent Set</option>
                <option value="min_vertex_cover">Min Vertex Cover</option>
                <option value="tree_diameter">Tree Diameter</option>
                <option value="sum_of_distances">Sum of Distances (Rerooting)</option>
                <option value="tree_matching">Tree Matching</option>
                <option value="tree_coloring">Tree Coloring (k=3)</option>
                <option value="longest_edge_path">Longest Path (Edge W)</option>
                <option value="bundle_example">Bundle (Interdependent DP)</option>
              </select>
            </div>
            <div class="flex gap-2">
              <button id="btnSaveFormula" class="btn text-xs px-2 py-1 rounded font-medium" style="background: var(--border); color: var(--text);" title="Save current formula">üíæ</button>
              <button id="btnDeleteFormula" class="btn text-xs px-2 py-1 rounded font-medium" style="background: var(--border); color: var(--text);" title="Delete saved formula">üóëÔ∏è</button>
              <button id="btnRunDp" class="btn text-xs px-3 py-1 rounded font-medium" style="background: var(--accent); color: var(--bg);">Run (Ctrl+Enter)</button>
            </div>
          </div>
          <div id="dpErrorBox" class="error-box hidden"></div>
          <div id="dpWarning" class="hidden text-xs mb-2 p-2 rounded" style="background: rgba(255,170,0,0.2); color: var(--orange);">Warning: Tree Mode is disabled. DP requires a tree structure.</div>
          <textarea id="dpCode" class="w-full text-xs" rows="8" placeholder="dp = val + sum(children, dp)" title="Press F to focus | Esc to unfocus | Ctrl+Enter to run"></textarea>
        </div>
      </div>

      <div class="space-y-3">
        <div class="flex border-b" style="border-color: var(--border);">
          <button class="tab-btn active" data-tab="output">Output</button>
          <button class="tab-btn" data-tab="data">Data</button>
          <button class="tab-btn" data-tab="docs">Docs</button>
        </div>

        <div id="tab-output" class="tab-content">
          <div class="grid grid-cols-3 gap-2 mb-3">
            <div class="text-center p-2 rounded" style="background: var(--card);">
              <div class="text-xl font-bold mono" style="color: var(--accent);" id="statNodes">0</div>
              <div class="text-xs opacity-60">Nodes</div>
            </div>
            <div class="text-center p-2 rounded" style="background: var(--card);">
              <div class="text-xl font-bold mono" style="color: var(--accent);" id="statEdges">0</div>
              <div class="text-xs opacity-60">Edges</div>
            </div>
            <div class="text-center p-2 rounded" style="background: var(--card);">
              <div class="text-xl font-bold mono" style="color: var(--accent);" id="statRoot">-</div>
              <div class="text-xs opacity-60">Root</div>
            </div>
          </div>
          <div class="output-panel">
            <div class="output-header flex justify-between items-center">
              <span class="text-xs font-semibold">CP Format</span>
              <button id="btnCopy" class="text-xs px-2 py-0.5 rounded" style="background: var(--accent-dim); color: var(--accent); cursor:pointer; border:none;">Copy</button>
            </div>
            <div class="output-content p-3"><pre id="textOutput" class="mono text-xs" style="color: var(--muted);">0 0</pre></div>
          </div>
        </div>

        <div id="tab-data" class="tab-content hidden">
          <div class="output-panel">
            <div class="output-header text-xs font-semibold">Node Table</div>
            <div class="output-content p-2" id="dataTable">Empty</div>
          </div>
        </div>

        <div id="tab-docs" class="tab-content hidden">
          <div class="output-panel">
            <div class="output-header text-xs font-semibold">Documentation</div>
            <div class="output-content p-3 text-xs" id="docsContent"></div>
          </div>
        </div>

        <div id="selInfo" class="hidden p-3 rounded-lg" style="background: var(--card); border: 1px solid var(--border);">
          <div class="flex justify-between items-center mb-2">
            <span class="text-xs font-semibold">Selected: <span id="selName" class="mono" style="color: var(--accent);"></span></span>
            <button id="btnDelSel" class="text-xs px-2 py-0.5 rounded" style="background: var(--danger); cursor:pointer; border:none; color:white;">Del</button>
          </div>
          <label class="block text-xs opacity-60 mb-1">Weight</label>
          <input type="number" id="selWeight" class="w-full">
          <div id="selXYGroup" class="hidden mt-2">
            <div class="flex gap-2">
              <div class="flex-1">
                <label class="block text-xs opacity-60 mb-1">X</label>
                <input type="number" id="selX" class="w-full">
              </div>
              <div class="flex-1">
                <label class="block text-xs opacity-60 mb-1">Y</label>
                <input type="number" id="selY" class="w-full">
              </div>
            </div>
          </div>
          <div id="selDpVals" class="hidden mt-2 text-xs"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="dp-examples.js"></script>
  <script src="dp-docs.js"></script>
  <script src="dp-parser.js"></script>
  <script src="dp-engine.js"></script>
  <script src="state.js"></script>
  <script src="graph.js"></script>
  <script src="render.js"></script>
  <script src="events.js"></script>
</body>
</html>
